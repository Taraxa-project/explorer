{"ast":null,"code":"import config from 'config';\nimport mongoose from 'mongoose';\nimport Block from '../../models/block';\nexport default async function handler(req, res) {\n  try {\n    mongoose.connection._readyState || (await mongoose.connect(config.mongo.uri, config.mongo.options));\n  } catch (e) {\n    console.error(e);\n    return res.status(500).json({\n      error: 'Internal error. Please try your request again.'\n    });\n  }\n\n  let skip = Number(req.query.skip) || 0;\n  let limit = Number(req.query.limit) || 20;\n  let reverse = Boolean(req.query.reverse);\n  let fullTransactions = Boolean(req.query.fullTransactions) || false;\n\n  try {\n    let blocks = [];\n\n    if (fullTransactions) {\n      blocks = await Block.find().limit(limit).skip(skip).sort({\n        number: reverse ? -1 : 1\n      }).populate('transactions');\n    } else {\n      blocks = await Block.find().limit(limit).skip(skip).sort({\n        number: reverse ? -1 : 1\n      });\n    }\n\n    res.json(blocks);\n  } catch (e) {\n    console.error(e);\n    res.status(500).json({\n      error: 'Internal error. Please try your request again.'\n    });\n  }\n}","map":{"version":3,"sources":["/home/user1/Development/taraxa/explorer-api/pages/api/blocks.js"],"names":["config","mongoose","Block","handler","req","res","connection","_readyState","connect","mongo","uri","options","e","console","error","status","json","skip","Number","query","limit","reverse","Boolean","fullTransactions","blocks","find","sort","number","populate"],"mappings":"AAAA,OAAOA,MAAP,MAAmB,QAAnB;AACA,OAAOC,QAAP,MAAqB,UAArB;AAEA,OAAOC,KAAP,MAAkB,oBAAlB;AAEA,eAAe,eAAeC,OAAf,CAAuBC,GAAvB,EAA4BC,GAA5B,EAAiC;AAC5C,MAAI;AACAJ,IAAAA,QAAQ,CAACK,UAAT,CAAoBC,WAApB,KAAmC,MAAMN,QAAQ,CAACO,OAAT,CAAiBR,MAAM,CAACS,KAAP,CAAaC,GAA9B,EAAmCV,MAAM,CAACS,KAAP,CAAaE,OAAhD,CAAzC;AACH,GAFD,CAEE,OAAOC,CAAP,EAAU;AACRC,IAAAA,OAAO,CAACC,KAAR,CAAcF,CAAd;AACA,WAAOP,GAAG,CAACU,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AAACF,MAAAA,KAAK,EAAE;AAAR,KAArB,CAAP;AACH;;AAED,MAAIG,IAAI,GAAGC,MAAM,CAACd,GAAG,CAACe,KAAJ,CAAUF,IAAX,CAAN,IAA0B,CAArC;AACA,MAAIG,KAAK,GAAGF,MAAM,CAACd,GAAG,CAACe,KAAJ,CAAUC,KAAX,CAAN,IAA2B,EAAvC;AACA,MAAIC,OAAO,GAAGC,OAAO,CAAClB,GAAG,CAACe,KAAJ,CAAUE,OAAX,CAArB;AACA,MAAIE,gBAAgB,GAAGD,OAAO,CAAClB,GAAG,CAACe,KAAJ,CAAUI,gBAAX,CAAP,IAAuC,KAA9D;;AAEA,MAAI;AACA,QAAIC,MAAM,GAAG,EAAb;;AACA,QAAID,gBAAJ,EAAsB;AAClBC,MAAAA,MAAM,GAAG,MAAMtB,KAAK,CAACuB,IAAN,GAAaL,KAAb,CAAmBA,KAAnB,EAA0BH,IAA1B,CAA+BA,IAA/B,EAAqCS,IAArC,CAA0C;AAACC,QAAAA,MAAM,EAAEN,OAAO,GAAG,CAAC,CAAJ,GAAQ;AAAxB,OAA1C,EAAsEO,QAAtE,CAA+E,cAA/E,CAAf;AACH,KAFD,MAEO;AACHJ,MAAAA,MAAM,GAAG,MAAMtB,KAAK,CAACuB,IAAN,GAAaL,KAAb,CAAmBA,KAAnB,EAA0BH,IAA1B,CAA+BA,IAA/B,EAAqCS,IAArC,CAA0C;AAACC,QAAAA,MAAM,EAAEN,OAAO,GAAG,CAAC,CAAJ,GAAQ;AAAxB,OAA1C,CAAf;AACH;;AACDhB,IAAAA,GAAG,CAACW,IAAJ,CAASQ,MAAT;AACH,GARD,CAQE,OAAOZ,CAAP,EAAU;AACRC,IAAAA,OAAO,CAACC,KAAR,CAAcF,CAAd;AACAP,IAAAA,GAAG,CAACU,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AAACF,MAAAA,KAAK,EAAE;AAAR,KAArB;AACH;AACJ","sourcesContent":["import config from 'config';\nimport mongoose from 'mongoose';\n\nimport Block from '../../models/block';\n\nexport default async function handler(req, res) {\n    try {\n        mongoose.connection._readyState || await mongoose.connect(config.mongo.uri, config.mongo.options);\n    } catch (e) {\n        console.error(e);\n        return res.status(500).json({error: 'Internal error. Please try your request again.'});\n    }\n\n    let skip = Number(req.query.skip) || 0;\n    let limit = Number(req.query.limit) || 20;\n    let reverse = Boolean(req.query.reverse);\n    let fullTransactions = Boolean(req.query.fullTransactions) || false;\n\n    try {\n        let blocks = [];\n        if (fullTransactions) {\n            blocks = await Block.find().limit(limit).skip(skip).sort({number: reverse ? -1 : 1}).populate('transactions');\n        } else {\n            blocks = await Block.find().limit(limit).skip(skip).sort({number: reverse ? -1 : 1});\n        }\n        res.json(blocks);\n    } catch (e) {\n        console.error(e);\n        res.status(500).json({error: 'Internal error. Please try your request again.'});\n    }\n}\n"]},"metadata":{},"sourceType":"module"}